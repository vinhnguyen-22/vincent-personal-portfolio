import{w as g,r as v,p as y,t as S,D as l,b as p,d as b}from"./PresentationToolGrantsCheck-4e4b18b1.js";import{r as u,c as P}from"./sanity-05ba3066.js";const L=t=>t;function I(t,i,o,n=L,e="raw"){if(!i)return t;if(e!=="published"&&e!=="raw"&&e!=="previewDrafts")throw new Error(`Unknown perspective "${e}"`);return g(JSON.parse(JSON.stringify(t)),(r,c)=>{const f=v(c,i);if(!f)return r;const{mapping:d,pathSuffix:_}=f;if(d.type!=="value"||d.source.type!=="documentValue")return r;const s=i.documents[d.source.document],E=i.paths[d.source.path];if(s){const h=y(E+_),m=S(h);if(m==="_id")return r;let a;if(e==="previewDrafts"?(a=o(s._id.startsWith(l)?s:{...s,_id:`${l}${s._id}}`}),a||(a=o(s._id.startsWith(l)?{...s,_id:p(s._id)}:s)),a&&(a={...a,_id:p(s._id),_originalId:s._id})):a=o(s),!a)return r;const w=a?b(a,m,r):r;return r===w?r:n(w,{cachedDocument:a,previousValue:r,sourceDocument:s,sourcePath:h})}return r})}function N(t){const i=u.useMemo(()=>JSON.stringify(t||{}),[t]);return u.useMemo(()=>JSON.parse(i),[i])}function V(t){const{refreshInterval:i}=t,o=D(),[n,e]=u.useState("hit"),r=u.useCallback(()=>(e("inflight"),()=>e("hit")),[]);return u.useEffect(()=>{if(!i||n!=="hit")return;const c=setTimeout(()=>e("stale"),i);return()=>clearTimeout(c)},[i,n]),u.useEffect(()=>{if(n!=="hit")return;const c=()=>e("stale");return window.addEventListener("focus",c),()=>window.removeEventListener("focus",c)},[i,n]),u.useEffect(()=>{o&&n==="hit"&&e("stale"),!o&&n==="stale"&&e("refresh")},[o,n]),[n,r]}function D(){const t=P(2),[i,o]=u.useState(!1);let n,e;t[0]===Symbol.for("react.memo_cache_sentinel")?(n=()=>{o(navigator.onLine);const c=()=>o(!0),f=()=>o(!1);return window.addEventListener("online",c),window.addEventListener("offline",f),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",f)}},e=[],t[0]=n,t[1]=e):(n=t[0],e=t[1]),u.useEffect(n,e);const r=u.useSyncExternalStore(R,O,J);return!i||r==="hidden"}function J(){return"hidden"}function O(){return document.visibilityState}function R(t){return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)}export{V as a,I as b,N as u};
