import{g as Q,r as w,bJ as W,M as J,cq as _,cr as Z,u as tt,j as k,c as F,cs as L}from"./sanity-05ba3066.js";import{c as et,a as rt,g as it,b as D}from"./PresentationToolGrantsCheck-4e4b18b1.js";import{u as st,a as nt,b as ot}from"./hooks-d811cc7e.js";import"./DisplayedDocumentBroadcaster-5ec2fcf3.js";const at=["Value","Copy","Blank","ReturnIntoArray","ReturnIntoObject","ReturnIntoObjectSameKey","PushField","PushElement","PushParent","Pop","PushFieldCopy","PushFieldBlank","PushElementCopy","PushElementBlank","ReturnIntoObjectPop","ReturnIntoObjectSameKeyPop","ReturnIntoArrayPop","ObjectSetFieldValue","ObjectCopyField","ObjectDeleteField","ArrayAppendValue","ArrayAppendSlice","StringAppendString","StringAppendSlice"];class ut{constructor(t,e,i){this.model=t,this.root=e,this.patch=i,this.i=0,this.inputStack=[],this.outputStack=[]}read(){return this.patch[this.i++]}process(){for(this.inputStack.push({value:this.root}),this.outputStack.push({value:this.root});this.i<this.patch.length;){let e=this.read(),i=at[e];if(!i)throw new Error(`Unknown opcode: ${e}`);let s=`process${i}`;this[s].apply(this)}let t=this.outputStack.pop();return this.finalizeOutput(t)}inputEntry(){return this.inputStack[this.inputStack.length-1]}inputKey(t,e){return t.keys||(t.keys=this.model.objectGetKeys(t.value).sort()),t.keys[e]}outputEntry(){return this.outputStack[this.outputStack.length-1]}outputArray(){let t=this.outputEntry();return t.writeValue||(t.writeValue=this.model.copyArray(t.value)),t.writeValue}outputObject(){let t=this.outputEntry();return t.writeValue||(t.writeValue=this.model.copyObject(t.value)),t.writeValue}outputString(){let t=this.outputEntry();return t.writeValue||(t.writeValue=this.model.copyString(t.value)),t.writeValue}finalizeOutput(t){return t.writeValue?this.model.finalize(t.writeValue):t.value}processValue(){let t=this.model.wrap(this.read());this.outputStack.push({value:t})}processCopy(){let t=this.inputEntry();this.outputStack.push({value:t.value})}processBlank(){this.outputStack.push({value:null})}processReturnIntoArray(){let t=this.outputStack.pop(),e=this.finalizeOutput(t),i=this.outputArray();this.model.arrayAppendValue(i,e)}processReturnIntoObject(){let t=this.read(),e=this.outputStack.pop(),i=this.finalizeOutput(e);i=this.model.markChanged(i);let s=this.outputObject();this.model.objectSetField(s,t,i)}processReturnIntoObjectSameKey(){let t=this.inputEntry(),e=this.outputStack.pop(),i=this.finalizeOutput(e),s=this.outputObject();this.model.objectSetField(s,t.key,i)}processPushField(){let t=this.read(),e=this.inputEntry(),i=this.inputKey(e,t),s=this.model.objectGetField(e.value,i);this.inputStack.push({value:s,key:i})}processPushElement(){let t=this.read(),e=this.inputEntry(),i=this.model.arrayGetElement(e.value,t);this.inputStack.push({value:i})}processPop(){this.inputStack.pop()}processPushFieldCopy(){this.processPushField(),this.processCopy()}processPushFieldBlank(){this.processPushField(),this.processBlank()}processPushElementCopy(){this.processPushElement(),this.processCopy()}processPushElementBlank(){this.processPushElement(),this.processBlank()}processReturnIntoObjectPop(){this.processReturnIntoObject(),this.processPop()}processReturnIntoObjectSameKeyPop(){this.processReturnIntoObjectSameKey(),this.processPop()}processReturnIntoArrayPop(){this.processReturnIntoArray(),this.processPop()}processObjectSetFieldValue(){this.processValue(),this.processReturnIntoObject()}processObjectCopyField(){this.processPushField(),this.processCopy(),this.processReturnIntoObjectSameKey(),this.processPop()}processObjectDeleteField(){let t=this.read(),e=this.inputEntry(),i=this.inputKey(e,t),s=this.outputObject();this.model.objectDeleteField(s,i)}processArrayAppendValue(){let t=this.model.wrap(this.read()),e=this.outputArray();this.model.arrayAppendValue(e,t)}processArrayAppendSlice(){let t=this.read(),e=this.read(),i=this.outputArray(),s=this.inputEntry().value;this.model.arrayAppendSlice(i,s,t,e)}processStringAppendString(){let t=this.model.wrap(this.read()),e=this.outputString();this.model.stringAppendValue(e,t)}processStringAppendSlice(){let t=this.read(),e=this.read(),i=this.outputString(),s=this.inputEntry().value;this.model.stringAppendSlice(i,s,t,e)}}function ht(r){return r>>16?4:r>>11?3:r>>7?2:1}function K(r,t,e=0){let i=e,s=0;for(s=e;i<t;s++){let n=r.codePointAt(s),o=ht(n);o===4&&s++,i+=o}return s}class ct{wrap(t){return t}finalize(t){return Array.isArray(t)?t:t.data}markChanged(t){return t}objectGetKeys(t){return Object.keys(t)}objectGetField(t,e){return t[e]}arrayGetElement(t,e){return t[e]}copyObject(t){let e={type:"object",data:{}};if(t!==null)for(let[i,s]of Object.entries(t))e.data[i]=s;return e}copyArray(t){return t===null?[]:t.slice()}copyString(t){return{type:"string",data:t===null?"":t}}objectSetField(t,e,i){t.data[e]=i}objectDeleteField(t,e){delete t.data[e]}arrayAppendValue(t,e){t.push(e)}arrayAppendSlice(t,e,i,s){t.push(...e.slice(i,s))}stringAppendSlice(t,e,i,s){const n=e,o=K(n,i),h=K(n,s,o);t.data+=n.slice(o,h)}stringAppendValue(t,e){t.data+=e}}function lt(r,t){let e=r;return new ut(new ct,e,t).process()}function j(r){if(typeof r!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=r}typeof Symbol<"u"&&(j.prototype[Symbol.iterator]=function(){return this});j.of=function(){var r=arguments,t=r.length,e=0;return new j(function(){return e>=t?{done:!0}:{done:!1,value:r[e++]}})};j.empty=function(){var r=new j(function(){return{done:!0}});return r};j.fromSequence=function(r){var t=0,e=r.length;return new j(function(){return t>=e?{done:!0}:{done:!1,value:r[t++]}})};j.is=function(r){return r instanceof j?!0:typeof r=="object"&&r!==null&&typeof r.next=="function"};var pt=j,M={};M.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u";M.SYMBOL_SUPPORT=typeof Symbol<"u";var N=M,dt=N.ARRAY_BUFFER_SUPPORT,ft=N.SYMBOL_SUPPORT,U=function(t,e){var i,s,n,o,h;if(!t)throw new Error("obliterator/forEach: invalid iterable.");if(typeof e!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(t)||dt&&ArrayBuffer.isView(t)||typeof t=="string"||t.toString()==="[object Arguments]"){for(n=0,o=t.length;n<o;n++)e(t[n],n);return}if(typeof t.forEach=="function"){t.forEach(e);return}if(ft&&Symbol.iterator in t&&typeof t.next!="function"&&(t=t[Symbol.iterator]()),typeof t.next=="function"){for(i=t,n=0;h=i.next(),h.done!==!0;)e(h.value,n),n++;return}for(s in t)t.hasOwnProperty(s)&&e(t[s],s)},T={};(function(r){var t=Math.pow(2,8)-1,e=Math.pow(2,16)-1,i=Math.pow(2,32)-1,s=Math.pow(2,7)-1,n=Math.pow(2,15)-1,o=Math.pow(2,31)-1;r.getPointerArray=function(u){var a=u-1;if(a<=t)return Uint8Array;if(a<=e)return Uint16Array;if(a<=i)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},r.getSignedPointerArray=function(u){var a=u-1;return a<=s?Int8Array:a<=n?Int16Array:a<=o?Int32Array:Float64Array},r.getNumberType=function(u){return u===(u|0)?Math.sign(u)===-1?u<=127&&u>=-128?Int8Array:u<=32767&&u>=-32768?Int16Array:Int32Array:u<=255?Uint8Array:u<=65535?Uint16Array:Uint32Array:Float64Array};var h={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};r.getMinimalRepresentation=function(u,a){var c=null,f=0,y,v,m,d,p;for(d=0,p=u.length;d<p;d++)m=a?a(u[d]):u[d],v=r.getNumberType(m),y=h[v.name],y>f&&(f=y,c=v);return c},r.isTypedArray=function(u){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(u)},r.concat=function(){var u=0,a,c,f;for(a=0,f=arguments.length;a<f;a++)u+=arguments[a].length;var y=new arguments[0].constructor(u);for(a=0,c=0;a<f;a++)y.set(arguments[a],c),c+=arguments[a].length;return y},r.indices=function(u){for(var a=r.getPointerArray(u),c=new a(u),f=0;f<u;f++)c[f]=f;return c}})(T);var V={},Y=U,q=T;function yt(r){return Array.isArray(r)||q.isTypedArray(r)}function x(r){if(typeof r.length=="number")return r.length;if(typeof r.size=="number")return r.size}function mt(r){var t=x(r),e=typeof t=="number"?new Array(t):[],i=0;return Y(r,function(s){e[i++]=s}),e}function vt(r){var t=x(r),e=typeof t=="number"?q.getPointerArray(t):Array,i=typeof t=="number"?new Array(t):[],s=typeof t=="number"?new e(t):[],n=0;return Y(r,function(o){i[n]=o,s[n]=n++}),[i,s]}V.isArrayLike=yt;V.guessLength=x;V.toArray=mt;V.toArrayWithIndices=vt;var B=pt,wt=U,St=T,At=V;function A(r,t,e){if(arguments.length<2&&(e=r,r=null,t=null),this.capacity=e,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var i=St.getPointerArray(e);this.forward=new i(e),this.backward=new i(e),this.K=typeof r=="function"?new r(e):new Array(e),this.V=typeof t=="function"?new t(e):new Array(e),this.size=0,this.head=0,this.tail=0,this.items={}}A.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}};A.prototype.splayOnTop=function(r){var t=this.head;if(this.head===r)return this;var e=this.backward[r],i=this.forward[r];return this.tail===r?this.tail=e:this.backward[i]=e,this.forward[e]=i,this.backward[t]=r,this.head=r,this.forward[r]=t,this};A.prototype.set=function(r,t){var e=this.items[r];if(typeof e<"u"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?e=this.size++:(e=this.tail,this.tail=this.backward[e],delete this.items[this.K[e]]),this.items[r]=e,this.K[e]=r,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};A.prototype.setpop=function(r,t){var e=null,i=null,s=this.items[r];return typeof s<"u"?(this.splayOnTop(s),e=this.V[s],this.V[s]=t,{evicted:!1,key:r,value:e}):(this.size<this.capacity?s=this.size++:(s=this.tail,this.tail=this.backward[s],e=this.V[s],i=this.K[s],delete this.items[i]),this.items[r]=s,this.K[s]=r,this.V[s]=t,this.forward[s]=this.head,this.backward[this.head]=s,this.head=s,i?{evicted:!0,key:i,value:e}:null)};A.prototype.has=function(r){return r in this.items};A.prototype.get=function(r){var t=this.items[r];if(!(typeof t>"u"))return this.splayOnTop(t),this.V[t]};A.prototype.peek=function(r){var t=this.items[r];if(!(typeof t>"u"))return this.V[t]};A.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0,i=this.size,s=this.head,n=this.K,o=this.V,h=this.forward;e<i;)r.call(t,o[s],n[s],this),s=h[s],e++};A.prototype.keys=function(){var r=0,t=this.size,e=this.head,i=this.K,s=this.forward;return new B(function(){if(r>=t)return{done:!0};var n=i[e];return r++,r<t&&(e=s[e]),{done:!1,value:n}})};A.prototype.values=function(){var r=0,t=this.size,e=this.head,i=this.V,s=this.forward;return new B(function(){if(r>=t)return{done:!0};var n=i[e];return r++,r<t&&(e=s[e]),{done:!1,value:n}})};A.prototype.entries=function(){var r=0,t=this.size,e=this.head,i=this.K,s=this.V,n=this.forward;return new B(function(){if(r>=t)return{done:!0};var o=i[e],h=s[e];return r++,r<t&&(e=n[e]),{done:!1,value:[o,h]}})};typeof Symbol<"u"&&(A.prototype[Symbol.iterator]=A.prototype.entries);A.prototype.inspect=function(){for(var r=new Map,t=this.entries(),e;e=t.next(),!e.done;)r.set(e.value[0],e.value[1]);return Object.defineProperty(r,"constructor",{value:A,enumerable:!1}),r};typeof Symbol<"u"&&(A.prototype[Symbol.for("nodejs.util.inspect.custom")]=A.prototype.inspect);A.from=function(r,t,e,i){if(arguments.length<2){if(i=At.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var s=new A(t,e,i);return wt(r,function(n,o){s.set(o,n)}),s};var gt=A,z=gt,bt=U,It=T,Et=V;function R(r,t,e){arguments.length<2?z.call(this,r):z.call(this,r,t,e);var i=It.getPointerArray(this.capacity);this.deleted=new i(this.capacity),this.deletedSize=0}for(var $ in z.prototype)R.prototype[$]=z.prototype[$];typeof Symbol<"u"&&(R.prototype[Symbol.iterator]=z.prototype[Symbol.iterator]);R.prototype.clear=function(){z.prototype.clear.call(this),this.deletedSize=0};R.prototype.set=function(r,t){var e=this.items[r];if(typeof e<"u"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?(this.deletedSize>0?e=this.deleted[--this.deletedSize]:e=this.size,this.size++):(e=this.tail,this.tail=this.backward[e],delete this.items[this.K[e]]),this.items[r]=e,this.K[e]=r,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};R.prototype.setpop=function(r,t){var e=null,i=null,s=this.items[r];return typeof s<"u"?(this.splayOnTop(s),e=this.V[s],this.V[s]=t,{evicted:!1,key:r,value:e}):(this.size<this.capacity?(this.deletedSize>0?s=this.deleted[--this.deletedSize]:s=this.size,this.size++):(s=this.tail,this.tail=this.backward[s],e=this.V[s],i=this.K[s],delete this.items[i]),this.items[r]=s,this.K[s]=r,this.V[s]=t,this.forward[s]=this.head,this.backward[this.head]=s,this.head=s,i?{evicted:!0,key:i,value:e}:null)};R.prototype.delete=function(r){var t=this.items[r];if(typeof t>"u")return!1;if(delete this.items[r],this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,!0;var e=this.backward[t],i=this.forward[t];return this.head===t&&(this.head=i),this.tail===t&&(this.tail=e),this.forward[e]=i,this.backward[i]=e,this.size--,this.deleted[this.deletedSize++]=t,!0};R.prototype.remove=function(r,t=void 0){var e=this.items[r];if(typeof e>"u")return t;var i=this.V[e];if(delete this.items[r],this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,i;var s=this.backward[e],n=this.forward[e];return this.head===e&&(this.head=n),this.tail===e&&(this.tail=s),this.forward[s]=n,this.backward[n]=s,this.size--,this.deleted[this.deletedSize++]=e,i};R.from=function(r,t,e,i){if(arguments.length<2){if(i=Et.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var s=new R(t,e,i);return bt(r,function(n,o){s.set(o,n)}),s};var Pt=R;const jt=Q(Pt);function Ft(r){const{liveDocument:t,controller:e,perspective:i,documentsOnPage:s,onLoadersConnection:n,onDocumentsOnPage:o}=r,[h,u]=w.useState(),[a,c]=w.useState({}),f=W(),y=J();w.useEffect(()=>{const g=setInterval(()=>c(l=>{if(Object.keys(l).length<1)return l;const P=Date.now();if(!Object.values(l).some(O=>O.heartbeat!==!1&&P>O.receivedAt+O.heartbeat))return l;const E={};for(const[O,C]of Object.entries(l))C.heartbeat!==!1&&P>C.receivedAt+C.heartbeat||(E[O]=C);return E}),_);return()=>clearInterval(g)},[]),w.useEffect(()=>{if(e){const g=e.createChannel({name:"presentation",connectTo:"loaders",heartbeat:!0},et().provide({actors:rt()}));return u(g),g.onStatus(n),g.on("loader/documents",l=>{l.projectId===f&&l.dataset===y&&o("loaders",l.perspective,l.documents)}),g.on("loader/query-listen",l=>{if(l.projectId===f&&l.dataset===y){if(typeof l.heartbeat=="number"&&l.heartbeat<_)throw new Error(`Loader query listen heartbeat interval must be at least ${_}ms`);c(P=>({...P,[it(l.query,l.params)]:{perspective:l.perspective,query:l.query,params:l.params,receivedAt:Date.now(),heartbeat:l.heartbeat??!1}}))}}),g.start()}},[e,y,o,n,f]);const[v]=w.useState(()=>new jt(Z)),m=tt({apiVersion:"2023-10-16"}),d=w.useMemo(()=>m.config(),[m]),p=w.useMemo(()=>m.withConfig({resultSourceMap:"withKeyArraySelector"}),[m]);w.useEffect(()=>{if(h){const{projectId:g,dataset:l}=d;h.post("loader/perspective",{projectId:g,dataset:l,perspective:i})}},[h,d,i]);const I=w.useMemo(()=>{const g=s.map(({_id:E})=>E),l=[...new Set(g)],P=v.capacity;return l.length>=P&&(l.length=P),l},[v.capacity,s]),[S,b]=w.useState(0);return k.jsxs(k.Fragment,{children:[k.jsx(Rt,{cache:v,client:p,turboIds:I,setDocumentsCacheLastUpdated:b}),Object.entries(a).map(([g,{query:l,params:P,perspective:E}])=>k.jsx(Ot,{cache:v,projectId:d.projectId,dataset:d.dataset,perspective:E,query:l,params:P,comlink:h,client:p,refreshInterval:i?2e3:0,liveDocument:t,documentsCacheLastUpdated:S},`${g}${E}`))]})}const Rt=w.memo(function(r){const t=F(22),{cache:e,client:i,turboIds:s,setDocumentsCacheLastUpdated:n}=r;let o;t[0]===Symbol.for("react.memo_cache_sentinel")?(o=[],t[0]=o):o=t[0];const[h,u]=w.useState(o);let a,c;t[1]!==h||t[2]!==e||t[3]!==s?(a=()=>{const d=new Set(h.flat()),p=new Set;for(const S of s)!d.has(S)&&!e.has(S)&&p.add(S);const I=[...p].slice(0,L);I.length!==0&&u(S=>[...S.slice(-L),I])},c=[h,e,s],t[1]=h,t[2]=e,t[3]=s,t[4]=a,t[5]=c):(a=t[4],c=t[5]),w.useEffect(a,c);let f,y;t[6]!==e||t[7]!==i||t[8]!==n?(f=()=>{const d=i.listen("*",{},{events:["mutation"],effectFormat:"mendoza",includePreviousRevision:!1,includeResult:!1,tag:"presentation-loader"}).subscribe(p=>{var S,b;if(p.type==="mutation"&&p.transition==="disappear"&&e.delete(p.documentId)&&n(Date.now()),p.type!=="mutation"||!((b=(S=p.effects)==null?void 0:S.apply)!=null&&b.length))return;const I=e.peek(p.documentId);if(I){const g={...I};delete g._rev;const l=lt(g,p.effects.apply);e.set(p.documentId,l),n(Date.now())}});return()=>d.unsubscribe()},y=[e,i,n],t[6]=e,t[7]=i,t[8]=n,t[9]=f,t[10]=y):(f=t[9],y=t[10]),w.useEffect(f,y);let v;if(t[11]!==h||t[12]!==e||t[13]!==i||t[14]!==n){let d;t[16]!==e||t[17]!==i||t[18]!==n?(d=p=>k.jsx(X,{cache:e,client:i,ids:p,setDocumentsCacheLastUpdated:n},JSON.stringify(p)),t[16]=e,t[17]=i,t[18]=n,t[19]=d):d=t[19],v=h.map(d),t[11]=h,t[12]=e,t[13]=i,t[14]=n,t[15]=v}else v=t[15];let m;return t[20]!==v?(m=k.jsx(k.Fragment,{children:v}),t[20]=v,t[21]=m):m=t[21],m}),X=w.memo(function(r){const t=F(6),{client:e,cache:i,ids:s,setDocumentsCacheLastUpdated:n}=r;let o,h;return t[0]!==i||t[1]!==e||t[2]!==s||t[3]!==n?(o=()=>{const u=s.filter(a=>!i.has(a));u.length!==0&&e.getDocuments(u).then(a=>{for(const c of a)c&&(c!=null&&c._id)&&(i.set(c._id,c),n(Date.now()))},console.error)},h=[i,e,s,n],t[0]=i,t[1]=e,t[2]=s,t[3]=n,t[4]=o,t[5]=h):(o=t[4],h=t[5]),w.useEffect(o,h),null});X.displayName="GetDocuments";function Ot(r){const t=F(20),{cache:e,projectId:i,dataset:s,perspective:n,query:o,client:h,refreshInterval:u,liveDocument:a,comlink:c,documentsCacheLastUpdated:f}=r,y=st(r.params);let v;t[0]!==e||t[1]!==h||t[2]!==f||t[3]!==a||t[4]!==y||t[5]!==n||t[6]!==o||t[7]!==u?(v={cache:e,client:h,liveDocument:a,params:y,perspective:n,query:o,refreshInterval:u,documentsCacheLastUpdated:f},t[0]=e,t[1]=h,t[2]=f,t[3]=a,t[4]=y,t[5]=n,t[6]=o,t[7]=u,t[8]=v):v=t[8];const m=kt(v),d=m==null?void 0:m.result,p=m==null?void 0:m.resultSourceMap,I=m==null?void 0:m.tags;let S,b;return t[9]!==c||t[10]!==s||t[11]!==y||t[12]!==n||t[13]!==i||t[14]!==o||t[15]!==d||t[16]!==p||t[17]!==I?(S=()=>{p&&(c==null||c.post("loader/query-change",{projectId:i,dataset:s,perspective:n,query:o,params:y,result:d,resultSourceMap:p,tags:I}))},b=[c,s,y,n,i,o,d,p,I],t[9]=c,t[10]=s,t[11]=y,t[12]=n,t[13]=i,t[14]=o,t[15]=d,t[16]=p,t[17]=I,t[18]=S,t[19]=b):(S=t[18],b=t[19]),w.useEffect(S,b),null}function kt(r){const{cache:t,liveDocument:e,client:i,refreshInterval:s,query:n,params:o,perspective:h,documentsCacheLastUpdated:u}=r,[a,c]=w.useState(null),{projectId:f,dataset:y}=w.useMemo(()=>{const{projectId:S,dataset:b}=i.config();return{projectId:S,dataset:b}},[i]),[v,m]=w.useState(null);if(v)throw v;const[d,p]=nt({refreshInterval:s}),I=d==="refresh"||d==="inflight";return w.useEffect(()=>{if(!I)return;let S=!1,b=!1;const g=new AbortController;async function l(){const{signal:E}=g;b=!0;const{result:O,resultSourceMap:C,syncTags:H}=await i.fetch(n,o,{tag:"presentation-loader",signal:E,perspective:h,filterResponse:!1});b=!1,E.aborted||(c({result:O,resultSourceMap:C,tags:H}),S=!0)}const P=p();return l().catch(E=>{b=!1,E.name!=="AbortError"&&m(E)}).finally(P),()=>{!S&&!b&&g.abort()}},[i,y,e,o,h,f,n,I,p]),w.useMemo(()=>u&&(a!=null&&a.resultSourceMap)?{result:Ct(t,e,a.result,h,a.resultSourceMap),resultSourceMap:a.resultSourceMap}:a,[t,u,e,h,a])}let G=!1;function Ct(r,t,e,i,s){if(i==="raw")throw new Error("turboChargeResultIfSourceMap does not support raw perspective");return ot(e,s,n=>{if(n._projectId){G||(console.warn("Cross dataset references are not supported yet, ignoring source document",n),G=!0);return}return t!=null&&t._id&&D(t._id)===D(n._id)?t:r.get(n._id)},(n,{previousValue:o})=>typeof n=="number"&&typeof o=="string"?`${n}`:n,i)}export{Ft as default,Ct as turboChargeResultIfSourceMap};
